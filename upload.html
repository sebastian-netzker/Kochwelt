<html>

<head>
    <title> Kochwelt </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@100;300;400;500;600;700;800;900&amp;display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        form {
            display: flex;
            flex-direction: column;
        }

        .uploaddiv {
            margin-top: 130px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        fieldset {
            display: flex;
            flex-direction: column;
        }
    </style>
    <script>

        function createEntry(parentNodeId, prototypeId) {

            // Clone node

            parentNode = document.getElementById(parentNodeId);
            childNode = document.getElementById(prototypeId).cloneNode('deep');

            // Clean values and id (only first level of children is cleaned)

            childNode.removeAttribute('id');
            childNode.value = '';

            if (childNode.children.length > 0) {
                for (let i = 0; i < childNode.children.length; i++) {
                    childNode.children[i].value = '';
                    childNode.children[i].removeAttribute('id');
                }
            }

            // Insert

            lastChild = parentNode.children[parentNode.children.length - 2];
            parentNode.insertBefore(childNode, lastChild);

        }

        function removeEntry(parentNodeId) {
            parentNode = document.getElementById(parentNodeId);
            if (parentNode.children.length <= 4) {
                return;
            }
            else {
                parentNode.children[parentNode.children.length - 3].remove();
            }

        }

        function getIngredients() {
            let array = [];
            let ingredientNames = document.getElementsByName('ingredientName');
            let ingredientUnits = document.getElementsByName('ingredientUnit');
            let ingredientPortions = document.getElementsByName('ingredientPortion');

            for (let i = 0; i < ingredientNames.length; i++) {
                let ingredient = {};
                ingredient.portion = ingredientPortions[i].value;
                ingredient.unit = ingredientUnits[i].value;
                ingredient.name = ingredientNames[i].value;
                array.push(ingredient);
            }

            return array;

        }

        function getPreparationSteps(){
            let array = [];
            let preparations = document.getElementsByName('preparation');

            for (let i=0; i < preparations.length; i++){
                array.push(preparations[i].value);
            }            

            return array;
        }

        function createRecipeObject() {
            recipe = {};
            recipe.recepy = document.getElementById('recepy').value;
            recipe.ingredients = getIngredients();
            recipe.difficulty = document.getElementById('difficulty').value;
            recipe.preparation_time = document.getElementById('preparation_time').value;
            recipe.calories = document.getElementById('calories').value;
            recipe.category = document.getElementById('category').value;
            recipe.price = document.getElementById('price').value;
            recipe.preparation = getPreparationSteps();
            recipe.creator = document.getElementById('creator').value;
            return recipe;
        }

        function saveRecipe(){
            let recipe = createRecipeObject();
            console.log(recipe);
            return false
        }

    </script>
</head>

<body>
    <div class="navigation-bar">

        <img class="logo" src="img/logo.png">

        <nav class="navigation-menu">

            <a href="index.html"> Start </a>&nbsp; | &nbsp;
            <a href="recepy.html"> Rezept des Tages</a>&nbsp; | &nbsp;
            <a href="upload.html"> Upload </a>&nbsp; | &nbsp;
            <a href="contact.html"> Kontakt </a>&nbsp; | &nbsp;
            <a href="imprint.html"> Impressum </a>&nbsp; | &nbsp;
        </nav>
    </div>
    <div class="uploaddiv">
        <h1>Rezept einreichen</h1>
        <form id="recepyform" onsubmit="return saveRecipe();">
            <input type="text" id="recepy" placeholder="Rezeptname">
            <span>F端ge ein Bild hinzu</span>
            <input type="file" id="image">
            <fieldset id="ingredients">
                <label for="ingredients">Zutaten</label>
                <fieldset id="ingredientsPrototype" name="ingredient">
                    <input type="text" name="ingredientName" placeholder="Zutat">
                    <input type="text" name="ingredientPortion" placeholder="Menge">
                    <select name="ingredientUnit">
                        <option></option>
                        <option>g</option>
                        <option>l</option>
                        <option>ml</option>
                        <option>TL</option>
                        <option>EL</option>
                        <option>St端ck</option>
                        <option>Prise</option>
                    </select>
                </fieldset>
                <input type="button" value="Zutat hinzuf端gen"
                    onclick="createEntry('ingredients','ingredientsPrototype')">
                <input type="button" value="Zutat entfernen" onclick="removeEntry('ingredients')">
            </fieldset>

            <span>Schwierigkeit</span>
            <select id="difficulty">
                <option>Leicht</option>
                <option>Mittel</option>
                <option>Schwer</option>
            </select>

            <input type="text" id="preparation_time" placeholder="Zubereitungszeit in Minuten">

            <input type="text" id="calories" placeholder="Kalorien">

            <input type="text" id="category" placeholder="Kategorie">

            <input type="text" id="price" placeholder="Preis">

            <fieldset id="preparations">
                <span>Zubereitung</span>
                <input type="text" name="preparation" placeholder="Zubereitungsschritt" id="preparationPrototype">
                <input type="button" value="Schritt hinzuf端gen"
                    onclick="createEntry('preparations','preparationPrototype')">
                <input type="button" value="Schritt entfernen" onclick="removeEntry('preparations')">
            </fieldset>

            <input type="text" id="creator" placeholder="Ersteller*in">

            <input type="submit">
        </form>
    </div>
</body>

</html>